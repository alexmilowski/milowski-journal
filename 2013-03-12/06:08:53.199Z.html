<article xmlns="http://www.w3.org/1999/xhtml" vocab="http://schema.org/" typeof="BlogPosting" resource="http://www.milowski.com/journal/entry/2013-03-12T06:08:53.199000+00:00">
<script type="application/ld+json">
{
"@context" : "http://schema.org/",
"@id" : "http://www.milowski.com/journal/entry/2013-03-12T06:08:53.199000+00:00",
"genre" : "blog",
"headline" : "Refactoring the RDFa API - Getting the Data",
"description" : "After numerous inquires about my opinion on making the [RDFa API](http://www.w3.org/TR/rdfa-api/) simpler, I decided to do a bit of research. I've written several fairly complex *in-situ* services that use the RDFa API to provide functionality within the browser. As such, I decided to look at which parts of the RDFa API or the extensions that [Green Turtle ](https://code.google.com/p/green-turtle/) provides are actually used.",
"datePublished" : "2013-03-12T06:08:53.199000+00:00",
"dateModified" : "2013-03-12T06:08:53.199000+00:00",
"keywords" : "RDFa,JavaScript,RDFa API" ,
"author" : [ { "@type" : "Person", "name" : "Alex Mi≈Çowski" }]
}
</script>
<h1>Refactoring the RDFa API - Getting the Data</h1>
<p>After numerous inquires about my opinion on making the <a href="http://www.w3.org/TR/rdfa-api/">RDFa API</a> simpler, I decided to do a bit of research. I've written several fairly complex <em>in-situ</em> services that use the RDFa API to provide functionality within the browser. As such, I decided to look at which parts of the RDFa API or the extensions that <a href="https://code.google.com/p/green-turtle/">Green Turtle </a> provides are actually used.</p>
<p>I went through all my code and unceremonious counted all the different bits of RDFa related API calls I make. Here is the breakdown:</p>
<p>&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;Count&lt;/th&gt;
&lt;th colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;API&lt;/th&gt;
&lt;th colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;64&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;document.data.getValues()&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;Values given a subject and property URI.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;15&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;element.data.id&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;(<em>) The subject URI for an
element.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;10&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;document.getElementsByType()&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;Elements typed with a specific URI.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;6&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;document.getElementsBySubject()&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;Elements identified by a specific subject.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;4&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;document.data.getSubjects()&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;Subjects matching a given property and value.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;3&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;element.getElementsByType()&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;(</em>) Descendants typed with a specific
URI.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;2&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;element.data.getValueOrigins()&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;(<em>) Element origins of specific
property values.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;1&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;element.getElementsBySubject()&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;(</em>) Descendants with a specific
subject.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;1&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;&lt;code&gt;element.getFirstElementByType()&lt;/code&gt;&lt;/td&gt;
&lt;td colspan=&quot;1&quot; nowrap=&quot;none&quot; rowspan=&quot;1&quot;&gt;(*) First descendant typed with a
specific URI.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</p>
<p>(*) A Green Turtle extension.</p>
<p>The first thing that should be noted is that Green Turtle contains a bunch of extensions. I added these because either they were useful and, often, they accomplished a task that wasn't exposed through the normal API.  Specifically, element descendant local operations aren't really covered by the current RDFa API and this can be very important when trying to find annotations to elements within a specific part of the document.</p>
<p>From all of this I can say a few things right away:</p>
<ul>
<li>An enormous amount of work is just getting property values.  This needs to be easier and much less verbose.</li>
<li>There needs to be some parity between document and element/descendant operations. Specifically, getting elements by type or subject should be allowed at the document or element level.</li>
<li>A local data structure on elements with RDFa annotations is very useful and sometimes required.</li>
<li>On balance, so many odd little extensions isn't good.  If possible, I should probably figure out a way to not use them.</li>
</ul>
<p>Further, in looking at the use of the RDFa API, the most common design pattern was:</p>
<ul>
<li>Locate an element via <code>document.getElementsByType()</code> .</li>
<li>Get the subject URI associated with the element found in (1).</li>
<li>Poke at the annotation graph with <code>document.data.getValues()</code> .</li>
</ul>
<p>Note that (2) is actually quite hard to do with the plain RDFa API without some kind of extension that stores the subject URI on the element.  All the information is in the RDFa implementation's graph if it is going to support  <code>document.getElementsBySubject()</code> .  Yet, while you can easily get the type from a given subject URI associated with a particular element but you can't do the reverse without knowing the internals of how the annotation graph was generated.</p>
<p>Making this design pattern work really well with concise code and without excluding more complex operations should be the goal of any minimal API.</p>
</article>
